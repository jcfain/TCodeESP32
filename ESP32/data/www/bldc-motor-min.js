function updateBLDCSettings(){userSettings.BLDC_UseHallSensor=document.getElementById("BLDC_UseHallSensor").checked,Utils.toggleControlVisibilityByID("HallEffect",userSettings.BLDC_UseHallSensor),userSettings.BLDC_Pulley_Circumference=parseInt(document.getElementById("BLDC_Pulley_Circumference").value),userSettings.BLDC_MotorA_Voltage=Utils.round2(parseFloat(document.getElementById("BLDC_MotorA_Voltage").value)),userSettings.BLDC_MotorA_Current=Utils.round2(parseFloat(document.getElementById("BLDC_MotorA_Current").value)),userSettings.BLDC_MotorA_ZeroElecAngle=Utils.round2(parseFloat(document.getElementById("BLDC_MotorA_ZeroElecAngle").value)),userSettings.BLDC_MotorA_ParametersKnown=document.getElementById("BLDC_MotorA_ParametersKnown").checked,userSettings.BLDC_RailLength=parseInt(document.getElementById("BLDC_RailLength").value),userSettings.BLDC_StrokeLength=parseInt(document.getElementById("BLDC_StrokeLength").value),Utils.toggleControlVisibilityByID("ZeroElecAngle",userSettings.BLDC_MotorA_ParametersKnown),setRestartRequired(),updateUserSettings()}function updateEncoderType(e){userSettings.BLDC_UsePWM=!1,userSettings.BLDC_UseMT6701=!1,userSettings[e]=!0,Utils.toggleControlVisibilityByClassName("BLDCPWM",userSettings.BLDC_UsePWM),Utils.toggleControlVisibilityByClassName("BLDCSPI",!userSettings.BLDC_UsePWM),setRestartRequired(),updateUserSettings()}function updateBLDCPins(){null!==upDateTimeout&&clearTimeout(upDateTimeout),upDateTimeout=setTimeout((()=>{var e=validateBLDCPins();e&&(userSettings.BLDC_ChipSelect_PIN=e.BLDC_ChipSelect_PIN,userSettings.BLDC_Encoder_PIN=e.BLDC_Encoder_PIN,userSettings.BLDC_Enable_PIN=e.BLDC_Enable_PIN,userSettings.BLDC_PWMchannel1_PIN=e.BLDC_PWMchannel1_PIN,userSettings.BLDC_PWMchannel2_PIN=e.BLDC_PWMchannel2_PIN,userSettings.BLDC_PWMchannel3_PIN=e.BLDC_PWMchannel3_PIN,userSettings.BLDC_HallEffect_PIN=e.BLDC_HallEffect_PIN,updateCommonPins(e),setRestartRequired(),updateUserSettings())}),2e3)}function getBLDCPinValues(){var e={};return e.BLDC_ChipSelect_PIN=parseInt(document.getElementById("BLDC_ChipSelect_PIN").value),e.BLDC_Encoder_PIN=parseInt(document.getElementById("BLDC_Encoder_PIN").value),e.BLDC_Enable_PIN=parseInt(document.getElementById("BLDC_Enable_PIN").value),e.BLDC_PWMchannel1_PIN=parseInt(document.getElementById("BLDC_PWMchannel1_PIN").value),e.BLDC_PWMchannel2_PIN=parseInt(document.getElementById("BLDC_PWMchannel2_PIN").value),e.BLDC_PWMchannel3_PIN=parseInt(document.getElementById("BLDC_PWMchannel3_PIN").value),e.BLDC_HallEffect_PIN=parseInt(document.getElementById("BLDC_HallEffect_PIN").value),getCommonPinValues(e),e}function validateBLDCPins(){clearErrors("pinValidation");var e=[],n=[],t=[],l=getBLDCPinValues();if(userSettings.disablePinValidation)return l;e.push({name:"SPI1",pin:18}),e.push({name:"SPI2",pin:19});var i=e.findIndex((e=>e.pin===l.BLDC_Encoder_PIN));i>-1&&n.push("Encoder pin and "+e[i].name),e.push({name:"Encoder",pin:l.BLDC_Encoder_PIN}),(i=e.findIndex((e=>e.pin===l.BLDC_ChipSelect_PIN)))>-1&&n.push("Chip select and "+e[i].name),e.push({name:"Chip select",pin:l.BLDC_ChipSelect_PIN}),(i=e.findIndex((e=>e.pin===l.BLDC_Enable_PIN)))>-1&&n.push("Enable pin and "+e[i].name),e.push({name:"Enable",pin:l.BLDC_Enable_PIN}),(i=e.findIndex((e=>e.pin===l.BLDC_PWMchannel1_PIN)))>-1&&n.push("PWMchannel1 pin and "+e[i].name),-1==validPWMpins.indexOf(l.BLDC_PWMchannel1_PIN)&&t.push("PWMchannel1 pin: "+l.BLDC_PWMchannel1_PIN),e.push({name:"PWMchannel1",pin:l.BLDC_PWMchannel1_PIN}),(i=e.findIndex((e=>e.pin===l.BLDC_PWMchannel2_PIN)))>-1&&n.push("PWMchannel2 pin and "+e[i].name),-1==validPWMpins.indexOf(l.BLDC_PWMchannel2_PIN)&&t.push("PWMchannel2 pin: "+l.BLDC_PWMchannel2_PIN),e.push({name:"PWMchannel2",pin:l.BLDC_PWMchannel2_PIN}),(i=e.findIndex((e=>e.pin===l.BLDC_PWMchannel3_PIN)))>-1&&n.push("PWMchannel3 pin and "+e[i].name),-1==validPWMpins.indexOf(l.BLDC_PWMchannel3_PIN)&&t.push("PWMchannel3pin: "+l.BLDC_PWMchannel3_PIN),e.push({name:"PWMchannel3",pin:l.BLDC_PWMchannel3_PIN}),userSettings.BLDC_UsePWM&&((i=e.findIndex((e=>e.pin===l.BLDC_HallEffect_PIN)))>-1&&n.push("Hall effect pin and "+e[i].name),e.push({name:"HallEffect",pin:l.BLDC_HallEffect_PIN})),validateCommonPWMPins(e,n,l,t);var s=[];if(validateNonPWMPins(e,n,s,l),n.length||t.length||s.length){var a="<div name='pinValidation'>Pins NOT saved due to invalid input.<br>";return n.length&&(a+="<div style='margin-left: 25px;'>The following pins are duplicated:<br><div style='color: white; margin-left: 25px;'>"+n.join("<br>")+"</div></div>"),s.length&&(n.length&&(a+="<br>"),a+="<div style='margin-left: 25px;'>The following pins are invalid:<br><div style='color: white; margin-left: 25px;'>"+s.join("<br>")+"</div></div>"),t.length&&((n.length||s.length)&&(a+="<br>"),a+="<div style='margin-left: 25px;'>The following pins are invalid PWM pins:<br><div style='color: white; margin-left: 25px;'>"+t.join("<br>")+"</div></div>"),a+="</div>",void showError(a)}return l}BLDCMotor={setup(){document.getElementById("BLDC_UsePWM").checked=userSettings.BLDC_UsePWM,document.getElementById("BLDC_UseMT6701").checked=userSettings.BLDC_UseMT6701,document.getElementById("BLDC_UseSPI").checked=!userSettings.BLDC_UseMT6701&&!userSettings.BLDC_UsePWM,document.getElementById("BLDC_UseHallSensor").checked=userSettings.BLDC_UseHallSensor,document.getElementById("BLDC_Pulley_Circumference").value=userSettings.BLDC_Pulley_Circumference,document.getElementById("BLDC_MotorA_Voltage").value=Utils.round2(userSettings.BLDC_MotorA_Voltage),document.getElementById("BLDC_MotorA_Current").value=Utils.round2(userSettings.BLDC_MotorA_Current),document.getElementById("BLDC_ChipSelect_PIN").value=userSettings.BLDC_ChipSelect_PIN,document.getElementById("BLDC_Encoder_PIN").value=userSettings.BLDC_Encoder_PIN,document.getElementById("BLDC_Enable_PIN").value=userSettings.BLDC_Enable_PIN,document.getElementById("BLDC_PWMchannel1_PIN").value=userSettings.BLDC_PWMchannel1_PIN,document.getElementById("BLDC_PWMchannel2_PIN").value=userSettings.BLDC_PWMchannel2_PIN,document.getElementById("BLDC_PWMchannel3_PIN").value=userSettings.BLDC_PWMchannel3_PIN,document.getElementById("BLDC_HallEffect_PIN").value=userSettings.BLDC_HallEffect_PIN,document.getElementById("BLDC_MotorA_ZeroElecAngle").value=Utils.round2(userSettings.BLDC_MotorA_ZeroElecAngle),document.getElementById("BLDC_MotorA_ParametersKnown").checked=userSettings.BLDC_MotorA_ParametersKnown,document.getElementById("BLDC_RailLength").value=userSettings.BLDC_RailLength,document.getElementById("BLDC_StrokeLength").value=userSettings.BLDC_StrokeLength,Utils.toggleControlVisibilityByClassName("BLDCPWM",userSettings.BLDC_UsePWM),Utils.toggleControlVisibilityByClassName("BLDCSPI",!userSettings.BLDC_UsePWM),Utils.toggleControlVisibilityByID("HallEffect",userSettings.BLDC_UseHallSensor),Utils.toggleControlVisibilityByID("ZeroElecAngle",userSettings.BLDC_MotorA_ParametersKnown)}};