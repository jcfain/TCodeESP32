function toggleMotionRandomSettings(e,t){const n=document.getElementById("motionOffsetRandom"+e+t).checked,o=document.getElementById("motionAmplitudeRandom"+e+t).checked,i=document.getElementById("motionPeriodRandom"+e+t).checked,a=document.getElementById("motionPhaseRandom"+e+t).checked;Utils.toggleControlVisibilityByID("motionOffsetRandomMinRow"+e+t,n),Utils.toggleControlVisibilityByID("motionOffsetRandomMaxRow"+e+t,n),Utils.toggleControlVisibilityByID("motionAmplitudeRandomMinRow"+e+t,o),Utils.toggleControlVisibilityByID("motionAmplitudeRandomMaxRow"+e+t,o),Utils.toggleControlVisibilityByID("motionPeriodRandomMinRow"+e+t,i),Utils.toggleControlVisibilityByID("motionPeriodRandomMaxRow"+e+t,i),Utils.toggleControlVisibilityByID("motionPhaseRandomMinRow"+e+t,a),Utils.toggleControlVisibilityByID("motionPhaseRandomMaxRow"+e+t,a),toggleMotionRandomMinMaxSettingsSettings(e,t)}function toggleMotionRandomSettingsElement(e,t,n){Utils.toggleElementShown(e,n),Utils.toggleElementShown(t,n)}function toggleMotionRandomMinMaxSettingsSettings(e,t){const n=document.getElementById("motionOffsetRandom"+e+t).checked,o=document.getElementById("motionAmplitudeRandom"+e+t).checked,i=document.getElementById("motionPeriodRandom"+e+t).checked,a=document.getElementById("motionPhaseRandom"+e+t).checked;Utils.toggleControlVisibilityByID("motionRandomChangeMinRow"+e+t,n||o||i||a),Utils.toggleControlVisibilityByID("motionRandomChangeMaxRow"+e+t,n||o||i||a)}function setMotionEnabledClicked(){userSettings.motionEnabled=!userSettings.motionEnabled,sendTCode(userSettings.motionEnabled?"$motion-enable":"$motion-disable"),MotionGenerator.setEnabledStatus()}function setMotionPeriodRandomClicked(e,t,n){var o=document.getElementById("motionPeriodRandom"+e+t).checked;const i=getMotionChannelIndex(e,n);userSettings.motionProfiles[e].channels[i].periodRan=o,Utils.toggleControlVisibilityByID("motionPeriodRandomMinRow"+e+t,userSettings.motionProfiles[e].channels[i].periodRan),Utils.toggleControlVisibilityByID("motionPeriodRandomMaxRow"+e+t,userSettings.motionProfiles[e].channels[i].periodRan),toggleMotionRandomMinMaxSettingsSettings(e,t),updateUserSettings()}function setMotionAmplitudeRandomClicked(e,t,n){var o=document.getElementById("motionAmplitudeRandom"+e+t).checked;const i=getMotionChannelIndex(e,n);userSettings.motionProfiles[e].channels[i].ampRan=o,Utils.toggleControlVisibilityByID("motionAmplitudeRandomMinRow"+e+t,o),Utils.toggleControlVisibilityByID("motionAmplitudeRandomMaxRow"+e+t,o),toggleMotionRandomMinMaxSettingsSettings(e,t),updateUserSettings()}function setMotionOffsetRandomClicked(e,t,n){var o=document.getElementById("motionOffsetRandom"+e+t).checked;const i=getMotionChannelIndex(e,n);userSettings.motionProfiles[e].channels[i].offsetRan=o,Utils.toggleControlVisibilityByID("motionOffsetRandomMinRow"+e+t,o),Utils.toggleControlVisibilityByID("motionOffsetRandomMaxRow"+e+t,o),toggleMotionRandomMinMaxSettingsSettings(e,t),updateUserSettings()}function setMotionPhaseRandomClicked(e,t,n){var o=document.getElementById("motionPhaseRandom"+e+t).checked;const i=getMotionChannelIndex(e,n);userSettings.motionProfiles[e].channels[i].phaseRan=o,Utils.toggleControlVisibilityByID("motionPhaseRandomMinRow"+e+t,o),Utils.toggleControlVisibilityByID("motionPhaseRandomMaxRow"+e+t,o),toggleMotionRandomMinMaxSettingsSettings(e,t),updateUserSettings()}function setMotionProfileDefault(){userSettings.motionDefaultProfileIndex=getMotionProfileSelectedIndex(),updateUserSettings(1)}MotionGenerator={channelTemplates:[],setup(){const e=document.getElementById("motionProfiles");removeAllChildren(e),channelTemplates=[],e.value=userSettings.motionDefaultProfileIndex;var t=getChannelMap();userSettings.motionProfiles.forEach(((e,n)=>{addMotionProfileOption(n,e);var o=document.createElement("div");o.classList.add("formTable"),o.style="box-shadow: none; width: 100%;",o.id="channelContainer"+n,o.name="channelContainer";var i=document.createElement("div"),a=document.createElement("div");a.classList.add("tHeader"),i.appendChild(a);let s=Utils.createTextFormRow(0,"Profile name","motionProfileName"+n,e.name,31,function(e){setMotionGeneratorName(e)}.bind(this,n));i.appendChild(s.row),t.forEach(((e,t)=>{var o=e.channel,a=e.channelName,s=userSettings.motionProfiles[n].channels.findIndex((e=>e.name==o));const l=userSettings.motionProfiles[n].channels[s];var d=document.createElement("div");d.classList.add("tRow"),d.classList.add("motion-profile-edit-channel-header");var m=document.createElement("div");m.classList.add("tCell");var r=document.createElement("div");r.classList.add("tCell");var c=document.createElement("span");c.for="motionChannelCheckbox"+n+t,c.innerText=a+" ("+o+")";var u=document.createElement("input");u.id="motionChannelCheckbox"+n+t,u.type="checkbox",u.classList.add("motion-profile-edit-channel-header-checkbox"),u.value=`{"channelName": "${o}", "profileIndex": ${n}, "channelIndex": ${t}}`,u.checked=s>-1,u.onclick=function(){var e=JSON.parse(this.value);const t=getMotionChannelIndex(e.profileIndex,e.channelName);if(t>-1){if(!confirm("In order to save memory, this action will set the channel settings for this profile to DEFAULT. Are you sure?"))return;userSettings.motionProfiles[e.profileIndex].channels.splice(t,1)}this.checked?userSettings.motionProfiles[e.profileIndex].channels.push(getDefaultMotionChannel(e.channelName)):Utils.toggleControlVisibilityByID("channelTable"+e.profileIndex+e.channelIndex,!1,!0);const n=document.getElementById("motionChannelEditButton"+e.profileIndex+e.channelIndex);Utils.toggleElementShown(n,this.checked),n.disabled=!this.checked,updateUserSettings()};var g=document.createElement("button");g.id="motionChannelEditButton"+n+t,g.innerText="Edit",Utils.toggleElementShown(g,u.checked),g.disabled=!u.checked,g.onclick=function(){Utils.toggleControlVisibilityByName("channelTable",!1,!0);const e=this.classList.contains("button-pressed"),o=document.getElementsByClassName("button-pressed");for(var i=0;i<o.length;i++)o[i].classList.remove("button-pressed");e||(Utils.toggleControlVisibilityByID("channelTable"+n+t,!0,!0),this.classList.add("button-pressed"))},m.appendChild(c),m.appendChild(u),r.appendChild(g),d.appendChild(m),d.appendChild(r),i.appendChild(d);const f=document.createElement("div");f.id="channelTable"+n+t,f.setAttribute("name","channelTable"),f.classList.add("formTable"),Utils.toggleElementShown(f,!1,!0),f.style="box-shadow: none; width: auto; margin: 0; padding: 0;";const h=document.createElement("div");let M=Utils.createNumericFormRow(0,"Update rate (ms)","motionUpdate"+n+t,l?l.update:100,0,2147483647,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,t,o));M.title="This is the time in between updates that gives the system time to process other tasks. (DO NOT SET TOO LOW ON ESP32!)\n                It may be best to just leave at default.",h.appendChild(M.row),M=Utils.createNumericFormRow(0,"Period (ms)","motionPeriod"+n+t,l?l.period:2e3,0,2147483647,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,t,o)),M.title="This is the time it takes to make one stroke.\n                Lower is faster movement.",h.appendChild(M.row);const p=!!l&&l.periodRan;M=Utils.createCheckboxFormRow(0,"Period random","motionPeriodRandom"+n+t,p,function(e,t,n){setMotionPeriodRandomClicked(e,t,n)}.bind(this,n,t,o)),M.title="This is the time it takes to make one stroke.\n                Lower is faster movement.",h.appendChild(M.row),M=Utils.createNumericFormRow("motionPeriodRandomMinRow"+n+t,"Min (ms)","motionPeriodRandomMin"+n+t,l?l.periodMin:500,0,2147483647,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,t,o)),h.appendChild(M.row);let R=M.input,P=M;M=Utils.createNumericFormRow("motionPeriodRandomMaxRow"+n+t,"Max (ms)","motionPeriodRandomMax"+n+t,l?l.periodMax:2e3,0,2147483647,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,t,o)),h.appendChild(M.row),setElementsIntMinAndMax(R,M.input),toggleMotionRandomSettingsElement(P.row,M.row,p),M=Utils.createNumericFormRow(0,"Amplitude (%)","motionAmplitude"+n+t,l?l.amp:60,0,100,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,t,o)),h.appendChild(M.row);const x=!!l&&l.ampRan;M=Utils.createCheckboxFormRow(0,"Amplitude random","motionAmplitudeRandom"+n+t,x,function(e,t,n){setMotionAmplitudeRandomClicked(e,t,n)}.bind(this,n,t,o)),h.appendChild(M.row),M=Utils.createNumericFormRow("motionAmplitudeRandomMinRow"+n+t,"Min (%)","motionAmplitudeRandomMin"+n+t,l?l.ampMin:20,0,100,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,t,o)),h.appendChild(M.row),R=M.input,P=M,M=Utils.createNumericFormRow("motionAmplitudeRandomMaxRow"+n+t,"Max (%)","motionAmplitudeRandomMax"+n+t,l?l.ampMax:60,0,100,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,t,o)),h.appendChild(M.row),setElementsIntMinAndMax(R,M.input),toggleMotionRandomSettingsElement(P.row,M.row,x),M=Utils.createNumericFormRow(0,"Offset (tcode)","motionOffset"+n+t,l?l.offset:5e3,0,9999,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,t,o)),h.appendChild(M.row);const C=!!l&&l.offsetRan;M=Utils.createCheckboxFormRow(0,"Offset random","motionOffsetRandom"+n+t,C,function(e,t,n){setMotionOffsetRandomClicked(e,t,n)}.bind(this,n,t,o)),h.appendChild(M.row),M=Utils.createNumericFormRow("motionOffsetRandomMinRow"+n+t,"Min (tcode)","motionOffsetRandomMin"+n+t,l?l.offsetMin:3e3,0,9999,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,t,o)),h.appendChild(M.row),R=M.input,P=M,M=Utils.createNumericFormRow("motionOffsetRandomMaxRow"+n+t,"Max (tcode)","motionOffsetRandomMax"+n+t,l?l.offsetMax:7e3,0,9999,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,t,o)),h.appendChild(M.row),setElementsIntMinAndMax(R,M.input),toggleMotionRandomSettingsElement(P.row,M.row,C),M=Utils.createNumericFormRow(0,"Phase (degree)","motionPhase"+n+t,l?l.phase:0,0,180,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,t,o)),h.appendChild(M.row);const S=!!l&&l.phaseRan;M=Utils.createCheckboxFormRow(0,"Phase random","motionPhaseRandom"+n+t,S,function(e,t,n){setMotionPhaseRandomClicked(e,t,n)}.bind(this,n,t,o)),h.appendChild(M.row),M=Utils.createNumericFormRow("motionPhaseRandomMinRow"+n+t,"Min (degree)","motionPhaseRandomMin"+n+t,l?l.phaseMin:0,0,180,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,t,o)),h.appendChild(M.row),R=M.input,P=M,M=Utils.createNumericFormRow("motionPhaseRandomMaxRow"+n+t,"Max (degree)","motionPhaseRandomMax"+n+t,l?l.phaseMax:180,0,180,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,t,o)),h.appendChild(M.row),setElementsIntMinAndMax(R,M.input),toggleMotionRandomSettingsElement(P.row,M.row,S),M=Utils.createNumericFormRow("motionRandomChangeMinRow"+n+t,"Random change max (ms)","motionRandomChangeMin"+n+t,l?l.ranMin:3e3,0,2147483647,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,t,o)),h.appendChild(M.row),R=M.input,P=M,M=Utils.createNumericFormRow("motionRandomChangeMaxRow"+n+t,"Random change max (ms)","motionRandomChangeMax"+n+t,l?l.ranMax:3e4,0,2147483647,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,t,o)),h.appendChild(M.row),setElementsIntMinAndMax(R,M.input),toggleMotionRandomSettingsElement(P.row,M.row,S||x||C||p);document.createElement("button").onclick=function(e,t,n){setMotionGeneratorSettingsDefault(e,t,n)}.bind(this,n,t,o),i.appendChild(f),f.appendChild(h)})),o.appendChild(i),channelTemplates.push(o)}));const n=document.createElement("button");n.innerText="Set selected profile as defualt",n.onclick=setMotionProfileDefault,e.appendChild(n),selectMotionProfile(userSettings.motionDefaultProfileIndex)},setEnabledStatus(){var e=document.getElementById("motionEnabledToggle");e.innerText=userSettings.motionEnabled?"Stop":"Start",userSettings.motionEnabled?(e.classList.add("button-toggle-stop"),e.classList.remove("button-toggle-start")):(e.classList.remove("button-toggle-stop"),e.classList.add("button-toggle-start"))}};var validateGeneratorSettingsDebounce,setMotionGeneratorNameDebounce,selectedMotionProfileIndex=0;function getMotionProfileSelectedIndex(){return selectedMotionProfileIndex}function setSelectedMotionProfileIndex(e){selectedMotionProfileIndex=parseInt(e)}function clearMotionProfileSelection(){var e=document.getElementsByName("motionProfileButton");e&&e.forEach((e=>e.classList.remove("button-pressed")))}function selectMotionProfile(e,t){clearMotionProfileSelection(),setSelectedMotionProfileIndex(e);document.getElementById(`motionProfile${e}`).classList.add("button-pressed"),t&&sendTCode(`$motion-set-profile:${e+1}`)}function editMotionProfile(e){const t=document.getElementById("motionChannelsModal");removeAllChildren(t),t.appendChild(channelTemplates[e]),setMotionGeneratorSettingsProfile(e);const n=document.createElement("span");n.innerText="Edit profile",n.setAttribute("slot","title"),t.appendChild(n),t.setAttribute("visible",!0)}function setMotionGeneratorSettings(e,t,n){validateGeneratorSettingsDebounce&&clearTimeout(validateGeneratorSettingsDebounce),validateGeneratorSettingsDebounce=setTimeout(function(e,t,n){var o=userSettings.motionProfiles[e].channels.findIndex((e=>e.name==n));if(-1!=i){var i=userSettings.motionProfiles[e].channels[o];validateIntControl("motionUpdate"+e+t,i,"update"),validateIntControl("motionPeriod"+e+t,i,"period"),validateIntControl("motionAmplitude"+e+t,i,"amp"),validateIntControl("motionOffset"+e+t,i,"offset"),validateIntControl("motionPhase"+e+t,i,"phase"),setIntMinAndMax("motionPeriodRandomMin"+e+t,"motionPeriodRandomMax"+e+t),validateIntControl("motionPeriodRandomMin"+e+t,i,"periodMin"),validateIntControl("motionPeriodRandomMax"+e+t,i,"periodMax"),setIntMinAndMax("motionAmplitudeRandomMin"+e+t,"motionAmplitudeRandomMax"+e+t),validateIntControl("motionAmplitudeRandomMin"+e+t,i,"ampMin"),validateIntControl("motionAmplitudeRandomMax"+e+t,i,"ampMax"),setIntMinAndMax("motionOffsetRandomMin"+e+t,"motionOffsetRandomMax"+e+t),validateIntControl("motionOffsetRandomMin"+e+t,i,"offsetMin"),validateIntControl("motionOffsetRandomMax"+e+t,i,"offsetMax"),setIntMinAndMax("motionPhaseRandomMin"+e+t,"motionPhaseRandomMax"+e+t),validateFloatControl("motionPhaseRandomMin"+e+t,i,"phaseMin"),validateFloatControl("motionPhaseRandomMax"+e+t,i,"phaseMax"),setIntMinAndMax("motionRandomChangeMin"+e+t,"motionRandomChangeMax"+e+t),validateIntControl("motionRandomChangeMin"+e+t,i,"ranMin"),validateIntControl("motionRandomChangeMax"+e+t,i,"ranMax"),updateUserSettings(1)}else showError("There was an error finding a channel with name: "+n)}.bind(this,e,t,n),3e3)}function setMotionGeneratorName(e){setMotionGeneratorNameDebounce&&clearTimeout(setMotionGeneratorNameDebounce),setMotionGeneratorNameDebounce=setTimeout(function(e){validateStringControl("motionProfileName"+e,userSettings.motionProfiles[e],"name")&&(updateMotionProfileName(e),updateUserSettings(1))}.bind(this,e),3e3)}function addMotionProfileOption(e,t){document.getElementsByName("channelContainer").forEach((e=>{Utils.toggleElementShown(e,!1)}));const n=document.getElementById("motionProfiles");var o=document.createElement("button");o.id=`motionProfile${e}`,o.name="motionProfileButton",o.value=e,o.innerText=t.name,o.style.width="80%",o.onclick=function(e){selectMotionProfile(e,!0)}.bind(this,e);var i=document.createElement("button");i.id=`motionProfileEdit${e}`,i.name="motionProfileEditButton",i.value=e,i.innerText="Edit",i.style.width="20%",i.onclick=function(e){editMotionProfile(e)}.bind(this,e),n.appendChild(o),n.appendChild(i)}function updateMotionProfileName(e){const t=document.getElementsByName("motionProfileButton");for(var n=getMotionProfileSelectedIndex(),o=0;o<t.length;o++)if(t[o].value==e){n=o;break}t[n].innerText=userSettings.motionProfiles[e].name}function setMotionGeneratorSettingsDefault(e,t,n){confirm(`Are you sure you want to set the current channel '${n}' in profile '${userSettings.motionProfiles[e].name}' to the default settings?`)&&(setProfileMotionGeneratorSettingsDefault(e,t,n),updateUserSettings(1))}function getMotionChannelIndex(e,t){return userSettings.motionProfiles[e].channels.findIndex((e=>e.name==t))}function getDefaultMotionChannel(e){return{name:e,update:100,period:2e3,amp:60,offset:5e3,periodRan:!1,periodMin:500,periodMax:2e3,ampRan:!1,ampMin:20,ampMax:60,offsetRan:!1,offsetMin:3e3,offsetMax:7e3,ranMin:3e3,ranMax:3e4,phase:0,phaseRan:!1,phaseMin:0,phaseMax:180,reverse:!1}}function setProfileMotionGeneratorSettingsDefault(e,t,n){userSettings.motionProfiles[e].name="Profile "+(e+1),userSettings.motionProfiles[e].channels[t]=getDefaultMotionChannel(n),setMotionGeneratorSettingsProfile(e)}function setMotionGeneratorSettingsProfile(e){document.getElementById("motionProfileName"+e).value=userSettings.motionProfiles[e].name;getChannelMap().forEach(((t,n)=>{const o=getMotionChannelIndex(e,t.channel),i=o>-1,a=getDefaultMotionChannel();document.getElementById("motionUpdate"+e+n).value=i?userSettings.motionProfiles[e].channels[o].update:a.update,document.getElementById("motionPeriod"+e+n).value=i?userSettings.motionProfiles[e].channels[o].period:a.period,document.getElementById("motionAmplitude"+e+n).value=i?userSettings.motionProfiles[e].channels[o].amp:a.amp,document.getElementById("motionOffset"+e+n).value=i?userSettings.motionProfiles[e].channels[o].offset:a.offset,document.getElementById("motionPhase"+e+n).value=i?userSettings.motionProfiles[e].channels[o].phase:a.phase,document.getElementById("motionPhaseRandom"+e+n).checked=i?userSettings.motionProfiles[e].channels[o].phaseRan:a.phaseRan,document.getElementById("motionPhaseRandomMin"+e+n).value=i?userSettings.motionProfiles[e].channels[o].phaseMin:a.phaseMin,document.getElementById("motionPhaseRandomMax"+e+n).value=i?userSettings.motionProfiles[e].channels[o].phaseMax:a.phaseMax,document.getElementById("motionPeriodRandom"+e+n).checked=i?userSettings.motionProfiles[e].channels[o].periodRan:a.periodRan,document.getElementById("motionPeriodRandomMin"+e+n).value=i?userSettings.motionProfiles[e].channels[o].periodMin:a.periodMin,document.getElementById("motionPeriodRandomMax"+e+n).value=i?userSettings.motionProfiles[e].channels[o].periodMax:a.periodMax,document.getElementById("motionAmplitudeRandom"+e+n).checked=i?userSettings.motionProfiles[e].channels[o].ampRan:a.ampRan,document.getElementById("motionAmplitudeRandomMin"+e+n).value=i?userSettings.motionProfiles[e].channels[o].ampMin:a.ampMin,document.getElementById("motionAmplitudeRandomMax"+e+n).value=i?userSettings.motionProfiles[e].channels[o].ampMax:a.ampMax,document.getElementById("motionOffsetRandom"+e+n).checked=i?userSettings.motionProfiles[e].channels[o].offsetRan:a.offsetRan,document.getElementById("motionOffsetRandomMin"+e+n).value=i?userSettings.motionProfiles[e].channels[o].offsetMin:a.offsetMin,document.getElementById("motionOffsetRandomMax"+e+n).value=i?userSettings.motionProfiles[e].channels[o].offsetMax:a.offsetMax,document.getElementById("motionRandomChangeMin"+e+n).value=i?userSettings.motionProfiles[e].channels[o].ranMin:a.ranMin,document.getElementById("motionRandomChangeMax"+e+n).value=i?userSettings.motionProfiles[e].channels[o].ranMax:a.ranMax,toggleMotionRandomSettings(e,n)}))}