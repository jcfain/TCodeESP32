function toggleMotionRandomSettings(e,t){const n=document.getElementById("motionOffsetRandom"+e+t).checked,o=document.getElementById("motionAmplitudeRandom"+e+t).checked,i=document.getElementById("motionPeriodRandom"+e+t).checked,a=document.getElementById("motionPhaseRandom"+e+t).checked;Utils.toggleControlVisibilityByID("motionOffsetRandomMinRow"+e+t,n),Utils.toggleControlVisibilityByID("motionOffsetRandomMaxRow"+e+t,n),Utils.toggleControlVisibilityByID("motionAmplitudeRandomMinRow"+e+t,o),Utils.toggleControlVisibilityByID("motionAmplitudeRandomMaxRow"+e+t,o),Utils.toggleControlVisibilityByID("motionPeriodRandomMinRow"+e+t,i),Utils.toggleControlVisibilityByID("motionPeriodRandomMaxRow"+e+t,i),Utils.toggleControlVisibilityByID("motionPhaseRandomMinRow"+e+t,a),Utils.toggleControlVisibilityByID("motionPhaseRandomMaxRow"+e+t,a),toggleMotionRandomMinMaxSettingsSettings(e,t)}function toggleMotionRandomSettingsElement(e,t,n){Utils.toggleElementShown(e,n),Utils.toggleElementShown(t,n)}function toggleMotionRandomMinMaxSettingsSettings(e,t){const n=document.getElementById("motionOffsetRandom"+e+t).checked,o=document.getElementById("motionAmplitudeRandom"+e+t).checked,i=document.getElementById("motionPeriodRandom"+e+t).checked,a=document.getElementById("motionPhaseRandom"+e+t).checked;Utils.toggleControlVisibilityByID("motionRandomChangeMinRow"+e+t,n||o||i||a),Utils.toggleControlVisibilityByID("motionRandomChangeMaxRow"+e+t,n||o||i||a)}function setMotionEnabledClicked(){systemInfo.motionEnabled=!systemInfo.motionEnabled,sendTCode(systemInfo.motionEnabled?"#motion-enable":"#motion-disable"),MotionGenerator.setEnabledStatus()}function setMotionPeriodRandomClicked(e,t,n){var o=document.getElementById("motionPeriodRandom"+e+t).checked;const i=getMotionChannelIndex(e,n);userSettings.motionProfiles[e].channels[i].periodRan=o,Utils.toggleControlVisibilityByID("motionPeriodRandomMinRow"+e+t,userSettings.motionProfiles[e].channels[i].periodRan),Utils.toggleControlVisibilityByID("motionPeriodRandomMaxRow"+e+t,userSettings.motionProfiles[e].channels[i].periodRan),toggleMotionRandomMinMaxSettingsSettings(e,t),updateUserSettings()}function setMotionAmplitudeRandomClicked(e,t,n){var o=document.getElementById("motionAmplitudeRandom"+e+t).checked;const i=getMotionChannelIndex(e,n);userSettings.motionProfiles[e].channels[i].ampRan=o,Utils.toggleControlVisibilityByID("motionAmplitudeRandomMinRow"+e+t,o),Utils.toggleControlVisibilityByID("motionAmplitudeRandomMaxRow"+e+t,o),toggleMotionRandomMinMaxSettingsSettings(e,t),updateUserSettings()}function setMotionOffsetRandomClicked(e,t,n){var o=document.getElementById("motionOffsetRandom"+e+t).checked;const i=getMotionChannelIndex(e,n);userSettings.motionProfiles[e].channels[i].offsetRan=o,Utils.toggleControlVisibilityByID("motionOffsetRandomMinRow"+e+t,o),Utils.toggleControlVisibilityByID("motionOffsetRandomMaxRow"+e+t,o),toggleMotionRandomMinMaxSettingsSettings(e,t),updateUserSettings()}function setMotionPhaseRandomClicked(e,t,n){var o=document.getElementById("motionPhaseRandom"+e+t).checked;const i=getMotionChannelIndex(e,n);userSettings.motionProfiles[e].channels[i].phaseRan=o,Utils.toggleControlVisibilityByID("motionPhaseRandomMinRow"+e+t,o),Utils.toggleControlVisibilityByID("motionPhaseRandomMaxRow"+e+t,o),toggleMotionRandomMinMaxSettingsSettings(e,t),updateUserSettings()}function setMotionProfileDefault(){userSettings.motionDefaultProfileIndex=getMotionProfileSelectedIndex(),updateUserSettings(1)}MotionGenerator={channelTemplates:[],setup(){const e=document.getElementById("motionProfiles");removeAllChildren(e),channelTemplates=[],e.value=userSettings.motionDefaultProfileIndex;var t=getChannelMap();userSettings.motionProfiles.forEach(((e,n)=>{addMotionProfileOption(n,e);var o=document.createElement("div");o.classList.add("formTable"),o.style="box-shadow: none; width: 100%;",o.id="channelContainer"+n,o.name="channelContainer";var i=document.createElement("div"),a=document.createElement("div");a.classList.add("tHeader"),i.appendChild(a);let s=Utils.createTextFormRow(0,"Profile name","motionProfileName"+n,e.name,31,function(e){setMotionGeneratorName(e)}.bind(this,n));i.appendChild(s.row);for(var l=0;l<t.length;l++){const e=l;var d=t[l];if(!userSettings.sr6Mode&&d.sr6Only)continue;var m=d.channel,r=d.channelName,c=userSettings.motionProfiles[n].channels.findIndex((e=>e.name==m));const o=userSettings.motionProfiles[n].channels[c];var u=document.createElement("div");u.classList.add("tRow"),u.classList.add("motion-profile-edit-channel-header");var f=document.createElement("div");f.classList.add("tCell");var g=document.createElement("div");g.classList.add("tCell");var h=document.createElement("span");h.for="motionChannelCheckbox"+n+e,h.innerText=r+" ("+m+")";var M=document.createElement("input");M.id="motionChannelCheckbox"+n+e,M.type="checkbox",M.classList.add("motion-profile-edit-channel-header-checkbox"),M.value=`{"channelName": "${m}", "profileIndex": ${n}, "channelIndex": ${e}}`,M.checked=c>-1,M.onclick=function(){var e=JSON.parse(this.value);const t=getMotionChannelIndex(e.profileIndex,e.channelName);if(t>-1){if(!confirm("In order to save memory, this action will set the channel settings for this profile to DEFAULT. Are you sure?"))return;userSettings.motionProfiles[e.profileIndex].channels.splice(t,1)}this.checked?userSettings.motionProfiles[e.profileIndex].channels.push(getDefaultMotionChannel(e.channelName)):Utils.toggleControlVisibilityByID("channelTable"+e.profileIndex+e.channelIndex,!1,!0);const n=document.getElementById("motionChannelEditButton"+e.profileIndex+e.channelIndex);Utils.toggleElementShown(n,this.checked),n.disabled=!this.checked,updateUserSettings()};var p=document.createElement("button");p.id="motionChannelEditButton"+n+e,p.innerText="Edit",Utils.toggleElementShown(p,M.checked),p.disabled=!M.checked,p.onclick=function(){Utils.toggleControlVisibilityByName("channelTable",!1,!0);const t=this.classList.contains("button-pressed"),o=document.getElementsByClassName("button-pressed");for(var i=0;i<o.length;i++)o[i].classList.remove("button-pressed");t||(Utils.toggleControlVisibilityByID("channelTable"+n+e,!0,!0),this.classList.add("button-pressed"))},f.appendChild(h),f.appendChild(M),g.appendChild(p),u.appendChild(f),u.appendChild(g),i.appendChild(u);const a=document.createElement("div");a.id="channelTable"+n+e,a.setAttribute("name","channelTable"),a.classList.add("formTable"),Utils.toggleElementShown(a,!1,!0),a.style="box-shadow: none; width: auto; margin: 0; padding: 0;";const s=document.createElement("div");let R=Utils.createNumericFormRow(0,"Update rate (ms)","motionUpdate"+n+e,o?o.update:100,0,2147483647,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,e,m));R.title="This is the time in between updates that gives the system time to process other tasks. (DO NOT SET TOO LOW ON ESP32!)\n                It may be best to just leave at default.",s.appendChild(R.row),R=Utils.createNumericFormRow(0,"Period (ms)","motionPeriod"+n+e,o?o.period:2e3,0,2147483647,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,e,m)),R.title="This is the time it takes to make one stroke.\n                Lower is faster movement.",s.appendChild(R.row);const P=!!o&&o.periodRan;R=Utils.createCheckboxFormRow(0,"Period random","motionPeriodRandom"+n+e,P,function(e,t,n){setMotionPeriodRandomClicked(e,t,n)}.bind(this,n,e,m)),R.title="This is the time it takes to make one stroke.\n                Lower is faster movement.",s.appendChild(R.row),R=Utils.createNumericFormRow("motionPeriodRandomMinRow"+n+e,"Min (ms)","motionPeriodRandomMin"+n+e,o?o.periodMin:500,0,2147483647,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,e,m)),s.appendChild(R.row);let x=R.input,C=R;R=Utils.createNumericFormRow("motionPeriodRandomMaxRow"+n+e,"Max (ms)","motionPeriodRandomMax"+n+e,o?o.periodMax:2e3,0,2147483647,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,e,m)),s.appendChild(R.row),setElementsIntMinAndMax(x,R.input),toggleMotionRandomSettingsElement(C.row,R.row,P),R=Utils.createNumericFormRow(0,"Amplitude (%)","motionAmplitude"+n+e,o?o.amp:60,0,100,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,e,m)),s.appendChild(R.row);const S=!!o&&o.ampRan;R=Utils.createCheckboxFormRow(0,"Amplitude random","motionAmplitudeRandom"+n+e,S,function(e,t,n){setMotionAmplitudeRandomClicked(e,t,n)}.bind(this,n,e,m)),s.appendChild(R.row),R=Utils.createNumericFormRow("motionAmplitudeRandomMinRow"+n+e,"Min (%)","motionAmplitudeRandomMin"+n+e,o?o.ampMin:20,0,100,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,e,m)),s.appendChild(R.row),x=R.input,C=R,R=Utils.createNumericFormRow("motionAmplitudeRandomMaxRow"+n+e,"Max (%)","motionAmplitudeRandomMax"+n+e,o?o.ampMax:60,0,100,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,e,m)),s.appendChild(R.row),setElementsIntMinAndMax(x,R.input),toggleMotionRandomSettingsElement(C.row,R.row,S),R=Utils.createNumericFormRow(0,"Offset (tcode)","motionOffset"+n+e,o?o.offset:5e3,0,9999,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,e,m)),s.appendChild(R.row);const I=!!o&&o.offsetRan;R=Utils.createCheckboxFormRow(0,"Offset random","motionOffsetRandom"+n+e,I,function(e,t,n){setMotionOffsetRandomClicked(e,t,n)}.bind(this,n,e,m)),s.appendChild(R.row),R=Utils.createNumericFormRow("motionOffsetRandomMinRow"+n+e,"Min (tcode)","motionOffsetRandomMin"+n+e,o?o.offsetMin:3e3,0,9999,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,e,m)),s.appendChild(R.row),x=R.input,C=R,R=Utils.createNumericFormRow("motionOffsetRandomMaxRow"+n+e,"Max (tcode)","motionOffsetRandomMax"+n+e,o?o.offsetMax:7e3,0,9999,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,e,m)),s.appendChild(R.row),setElementsIntMinAndMax(x,R.input),toggleMotionRandomSettingsElement(C.row,R.row,I),R=Utils.createNumericFormRow(0,"Phase (degree)","motionPhase"+n+e,o?o.phase:0,0,180,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,e,m)),s.appendChild(R.row);const b=!!o&&o.phaseRan;R=Utils.createCheckboxFormRow(0,"Phase random","motionPhaseRandom"+n+e,b,function(e,t,n){setMotionPhaseRandomClicked(e,t,n)}.bind(this,n,e,m)),s.appendChild(R.row),R=Utils.createNumericFormRow("motionPhaseRandomMinRow"+n+e,"Min (degree)","motionPhaseRandomMin"+n+e,o?o.phaseMin:0,0,180,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,e,m)),s.appendChild(R.row),x=R.input,C=R,R=Utils.createNumericFormRow("motionPhaseRandomMaxRow"+n+e,"Max (degree)","motionPhaseRandomMax"+n+e,o?o.phaseMax:180,0,180,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,e,m)),s.appendChild(R.row),setElementsIntMinAndMax(x,R.input),toggleMotionRandomSettingsElement(C.row,R.row,b),R=Utils.createNumericFormRow("motionRandomChangeMinRow"+n+e,"Random change max (ms)","motionRandomChangeMin"+n+e,o?o.ranMin:3e3,0,2147483647,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,e,m)),s.appendChild(R.row),x=R.input,C=R,R=Utils.createNumericFormRow("motionRandomChangeMaxRow"+n+e,"Random change max (ms)","motionRandomChangeMax"+n+e,o?o.ranMax:3e4,0,2147483647,function(e,t,n){setMotionGeneratorSettings(e,t,n)}.bind(this,n,e,m)),s.appendChild(R.row),setElementsIntMinAndMax(x,R.input),toggleMotionRandomSettingsElement(C.row,R.row,b||S||I||P);document.createElement("button").onclick=function(e,t,n){setMotionGeneratorSettingsDefault(e,t,n)}.bind(this,n,e,m),i.appendChild(a),a.appendChild(s)}o.appendChild(i),channelTemplates.push(o)}));const n=document.createElement("button");n.innerText="Set selected profile as default",n.onclick=setMotionProfileDefault,e.appendChild(n);const o=document.createElement("button");o.innerText="Edit device range limits",o.onclick=DeviceRangeSlider.show,e.appendChild(o),selectMotionProfile(systemInfo.motionSelectedProfileIndex),this.setEnabledStatus()},setEnabledStatus(){var e=document.getElementById("motionEnabledToggle");e.innerText=systemInfo.motionEnabled?"Stop":"Start",systemInfo.motionEnabled?(e.classList.add("button-toggle-stop"),e.classList.remove("button-toggle-start")):(e.classList.remove("button-toggle-stop"),e.classList.add("button-toggle-start"))}};var validateGeneratorSettingsDebounce,setMotionGeneratorNameDebounce,selectedMotionProfileIndex=0;function getMotionProfileSelectedIndex(){return selectedMotionProfileIndex}function setSelectedMotionProfileIndex(e){selectedMotionProfileIndex=parseInt(e)}function clearMotionProfileSelection(){var e=document.getElementsByName("motionProfileButton");e&&e.forEach((e=>e.classList.remove("button-pressed")))}function selectMotionProfile(e,t){clearMotionProfileSelection(),setSelectedMotionProfileIndex(e);document.getElementById(`motionProfile${e}`).classList.add("button-pressed"),t&&sendTCode(`#motion-set-profile:${e+1}`)}function editMotionProfile(e){const t=document.getElementById("motionChannelsModal");removeAllChildren(t),t.appendChild(channelTemplates[e]),setMotionGeneratorSettingsProfile(e);const n=document.createElement("span");n.innerText="Edit profile",n.setAttribute("slot","title"),t.appendChild(n),t.show()}function setMotionGeneratorSettings(e,t,n){validateGeneratorSettingsDebounce&&clearTimeout(validateGeneratorSettingsDebounce),validateGeneratorSettingsDebounce=setTimeout(function(e,t,n){var o=userSettings.motionProfiles[e].channels.findIndex((e=>e.name==n));if(-1!=i){var i=userSettings.motionProfiles[e].channels[o];validateIntControl("motionUpdate"+e+t,i,"update"),validateIntControl("motionPeriod"+e+t,i,"period"),validateIntControl("motionAmplitude"+e+t,i,"amp"),validateIntControl("motionOffset"+e+t,i,"offset"),validateIntControl("motionPhase"+e+t,i,"phase"),setIntMinAndMax("motionPeriodRandomMin"+e+t,"motionPeriodRandomMax"+e+t),validateIntControl("motionPeriodRandomMin"+e+t,i,"periodMin"),validateIntControl("motionPeriodRandomMax"+e+t,i,"periodMax"),setIntMinAndMax("motionAmplitudeRandomMin"+e+t,"motionAmplitudeRandomMax"+e+t),validateIntControl("motionAmplitudeRandomMin"+e+t,i,"ampMin"),validateIntControl("motionAmplitudeRandomMax"+e+t,i,"ampMax"),setIntMinAndMax("motionOffsetRandomMin"+e+t,"motionOffsetRandomMax"+e+t),validateIntControl("motionOffsetRandomMin"+e+t,i,"offsetMin"),validateIntControl("motionOffsetRandomMax"+e+t,i,"offsetMax"),setIntMinAndMax("motionPhaseRandomMin"+e+t,"motionPhaseRandomMax"+e+t),validateFloatControl("motionPhaseRandomMin"+e+t,i,"phaseMin"),validateFloatControl("motionPhaseRandomMax"+e+t,i,"phaseMax"),setIntMinAndMax("motionRandomChangeMin"+e+t,"motionRandomChangeMax"+e+t),validateIntControl("motionRandomChangeMin"+e+t,i,"ranMin"),validateIntControl("motionRandomChangeMax"+e+t,i,"ranMax"),updateUserSettings(1)}else showError("There was an error finding a channel with name: "+n)}.bind(this,e,t,n),3e3)}function setMotionGeneratorName(e){setMotionGeneratorNameDebounce&&clearTimeout(setMotionGeneratorNameDebounce),setMotionGeneratorNameDebounce=setTimeout(function(e){validateStringControl("motionProfileName"+e,userSettings.motionProfiles[e],"name")&&(updateMotionProfileName(e),updateUserSettings(1))}.bind(this,e),3e3)}function addMotionProfileOption(e,t){document.getElementsByName("channelContainer").forEach((e=>{Utils.toggleElementShown(e,!1)}));const n=document.getElementById("motionProfiles");var o=document.createElement("button");o.id=`motionProfile${e}`,o.name="motionProfileButton",o.value=e,o.innerText=t.name,o.style.width="80%",o.onclick=function(e){selectMotionProfile(e,!0)}.bind(this,e);var i=document.createElement("button");i.id=`motionProfileEdit${e}`,i.name="motionProfileEditButton",i.value=e,i.innerText="Edit",i.style.width="20%",i.onclick=function(e){editMotionProfile(e)}.bind(this,e),n.appendChild(o),n.appendChild(i)}function updateMotionProfileName(e){const t=document.getElementsByName("motionProfileButton");for(var n=getMotionProfileSelectedIndex(),o=0;o<t.length;o++)if(t[o].value==e){n=o;break}t[n].innerText=userSettings.motionProfiles[e].name}function setMotionGeneratorSettingsDefault(e,t,n){confirm(`Are you sure you want to set the current channel '${n}' in profile '${userSettings.motionProfiles[e].name}' to the default settings?`)&&(setProfileMotionGeneratorSettingsDefault(e,t,n),updateUserSettings(1))}function getMotionChannelIndex(e,t){return userSettings.motionProfiles[e].channels.findIndex((e=>e.name==t))}function getDefaultMotionChannel(e){return{name:e,update:100,period:2e3,amp:60,offset:5e3,periodRan:!1,periodMin:500,periodMax:2e3,ampRan:!1,ampMin:20,ampMax:60,offsetRan:!1,offsetMin:3e3,offsetMax:7e3,ranMin:3e3,ranMax:3e4,phase:0,phaseRan:!1,phaseMin:0,phaseMax:180,reverse:!1}}function setProfileMotionGeneratorSettingsDefault(e,t,n){userSettings.motionProfiles[e].name="Profile "+(e+1),userSettings.motionProfiles[e].channels[t]=getDefaultMotionChannel(n),setMotionGeneratorSettingsProfile(e)}function setMotionGeneratorSettingsProfile(e){document.getElementById("motionProfileName"+e).value=userSettings.motionProfiles[e].name;const t=getChannelMap();for(var n=0;n<t.length;n++){const o=n,i=t[n];if(!userSettings.sr6Mode&&i.sr6Only)continue;const a=getMotionChannelIndex(e,i.channel),s=a>-1,l=getDefaultMotionChannel();document.getElementById("motionUpdate"+e+o).value=s?userSettings.motionProfiles[e].channels[a].update:l.update,document.getElementById("motionPeriod"+e+o).value=s?userSettings.motionProfiles[e].channels[a].period:l.period,document.getElementById("motionAmplitude"+e+o).value=s?userSettings.motionProfiles[e].channels[a].amp:l.amp,document.getElementById("motionOffset"+e+o).value=s?userSettings.motionProfiles[e].channels[a].offset:l.offset,document.getElementById("motionPhase"+e+o).value=s?userSettings.motionProfiles[e].channels[a].phase:l.phase,document.getElementById("motionPhaseRandom"+e+o).checked=s?userSettings.motionProfiles[e].channels[a].phaseRan:l.phaseRan,document.getElementById("motionPhaseRandomMin"+e+o).value=s?userSettings.motionProfiles[e].channels[a].phaseMin:l.phaseMin,document.getElementById("motionPhaseRandomMax"+e+o).value=s?userSettings.motionProfiles[e].channels[a].phaseMax:l.phaseMax,document.getElementById("motionPeriodRandom"+e+o).checked=s?userSettings.motionProfiles[e].channels[a].periodRan:l.periodRan,document.getElementById("motionPeriodRandomMin"+e+o).value=s?userSettings.motionProfiles[e].channels[a].periodMin:l.periodMin,document.getElementById("motionPeriodRandomMax"+e+o).value=s?userSettings.motionProfiles[e].channels[a].periodMax:l.periodMax,document.getElementById("motionAmplitudeRandom"+e+o).checked=s?userSettings.motionProfiles[e].channels[a].ampRan:l.ampRan,document.getElementById("motionAmplitudeRandomMin"+e+o).value=s?userSettings.motionProfiles[e].channels[a].ampMin:l.ampMin,document.getElementById("motionAmplitudeRandomMax"+e+o).value=s?userSettings.motionProfiles[e].channels[a].ampMax:l.ampMax,document.getElementById("motionOffsetRandom"+e+o).checked=s?userSettings.motionProfiles[e].channels[a].offsetRan:l.offsetRan,document.getElementById("motionOffsetRandomMin"+e+o).value=s?userSettings.motionProfiles[e].channels[a].offsetMin:l.offsetMin,document.getElementById("motionOffsetRandomMax"+e+o).value=s?userSettings.motionProfiles[e].channels[a].offsetMax:l.offsetMax,document.getElementById("motionRandomChangeMin"+e+o).value=s?userSettings.motionProfiles[e].channels[a].ranMin:l.ranMin,document.getElementById("motionRandomChangeMax"+e+o).value=s?userSettings.motionProfiles[e].channels[a].ranMax:l.ranMax,toggleMotionRandomSettings(e,o)}}